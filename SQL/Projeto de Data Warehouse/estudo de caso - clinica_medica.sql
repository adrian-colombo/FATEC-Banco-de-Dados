CREATE TABLE TEMPO (
    ID_TEMPO NUMBER(6) PRIMARY KEY,
    ANO NUMBER(4) NOT NULL,
    TRIMESTRE NUMBER(1) NOT NULL,
    MES NUMBER(1) NOT NULL
);

CREATE TABLE ESPECIALIDADE (
    ID_ESPECIALIDADE NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(60) NOT NULL
);

CREATE TABLE CLINICA (
    ID_CLINICA NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(120) NOT NULL
);

CREATE TABLE FAIXA_ETARIA (
    ID_FAIXA_ETARIA NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(30) NOT NULL
);

CREATE TABLE MEDICAMENTO (
    ID_MEDICAMENTO NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    MODO_USO VARCHAR2(120) NOT NULL
);

CREATE TABLE LOCAL (
    ID_LOCAL NUMBER(6) PRIMARY KEY,
    NOME VARCHAR2(120) NOT NULL
);

CREATE TABLE CONSULTA (
    ID_TEMPO NUMBER(6) NOT NULL,
    ID_ESPECIALIDADE NUMBER(6) NOT NULL,
    ID_CLINICA NUMBER(6) NOT NULL,
    ID_LOCAL NUMBER(6) NOT NULL,
    ID_FAIXA_ETARIA NUMBER(6) NOT NULL,
    GENERO CHAR(1) NOT NULL,
    FATURAMENTO DECIMAL(10,2) NOT NULL,

    CONSTRAINT PK_CONSULTA PRIMARY KEY (ID_TEMPO, ID_ESPECIALIDADE, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA), 
    CONSTRAINT FK_CONSULTA_TEMPO FOREIGN KEY (ID_TEMPO) REFERENCES TEMPO (ID_TEMPO),
    CONSTRAINT FK_CONSULTA_ESPECIALIDADE FOREIGN KEY (ID_ESPECIALIDADE) REFERENCES ESPECIALIDADE (ID_ESPECIALIDADE),
    CONSTRAINT FK_CONSULTA_CLINICA FOREIGN KEY (ID_CLINICA) REFERENCES CLINICA (ID_CLINICA),
    CONSTRAINT FK_CONSULTA_LOCAL FOREIGN KEY (ID_LOCAL) REFERENCES LOCAL (ID_LOCAL),
    CONSTRAINT FK_CONSULTA_FAIXA FOREIGN KEY (ID_FAIXA_ETARIA) REFERENCES FAIXA_ETARIA (ID_FAIXA_ETARIA),
    CONSTRAINT CK_GENERO CHECK (GENERO IN ('M', 'F'))
);

CREATE TABLE  PRESCRICAO (
    ID_TEMPO NUMBER(6) NOT NULL,
    ID_CLINICA NUMBER(6) NOT NULL,
    ID_LOCAL NUMBER(6) NOT NULL,
    ID_FAIXA_ETARIA NUMBER(6) NOT NULL,
    ID_MEDICAMENTO NUMBER(6) NOT NULL,
    GENERO CHAR(1) NOT NULL,
    FATURAMENTO DECIMAL(10,2) NOT NULL,

    CONSTRAINT PK_PRESCRICAO PRIMARY KEY (ID_TEMPO, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA), 
    CONSTRAINT FK_PRESCRICAO_TEMPO FOREIGN KEY (ID_TEMPO) REFERENCES TEMPO (ID_TEMPO),
    CONSTRAINT FK_PRESCRICAO_CLINICA FOREIGN KEY (ID_CLINICA) REFERENCES CLINICA (ID_CLINICA),
    CONSTRAINT FK_PRESCRICAO_LOCAL FOREIGN KEY (ID_LOCAL) REFERENCES LOCAL (ID_LOCAL),
    CONSTRAINT FK_PRESCRICAO_FAIXA FOREIGN KEY (ID_FAIXA_ETARIA) REFERENCES FAIXA_ETARIA (ID_FAIXA_ETARIA),
    CONSTRAINT FK_PRESCRICAO_MEDICAMENTO FOREIGN KEY (ID_MEDICAMENTO) REFERENCES MEDICAMENTO (ID_MEDICAMENTO),
    CONSTRAINT CK_PRS_GENERO CHECK (GENERO IN ('M', 'F'))
);

-- Inserts:

INSERT INTO TEMPO (ID_TEMPO, ANO, TRIMESTRE, MES) VALUES (1, 2022, 1, 1);
INSERT INTO TEMPO (ID_TEMPO, ANO, TRIMESTRE, MES) VALUES (2, 2022, 1, 2);
INSERT INTO TEMPO (ID_TEMPO, ANO, TRIMESTRE, MES) VALUES (3, 2022, 1, 3);
INSERT INTO TEMPO (ID_TEMPO, ANO, TRIMESTRE, MES) VALUES (4, 2022, 2, 4);
INSERT INTO TEMPO (ID_TEMPO, ANO, TRIMESTRE, MES) VALUES (5, 2022, 2, 5);

INSERT INTO ESPECIALIDADE (ID_ESPECIALIDADE, NOME) VALUES (1, 'Cardiologia');
INSERT INTO ESPECIALIDADE (ID_ESPECIALIDADE, NOME) VALUES (2, 'Dermatologia');
INSERT INTO ESPECIALIDADE (ID_ESPECIALIDADE, NOME) VALUES (3, 'Endocrinologia');
INSERT INTO ESPECIALIDADE (ID_ESPECIALIDADE, NOME) VALUES (4, 'Ortopedia');
INSERT INTO ESPECIALIDADE (ID_ESPECIALIDADE, NOME) VALUES (5, 'Pediatria');

INSERT INTO CLINICA (ID_CLINICA, NOME) VALUES (1, 'Clínica A');
INSERT INTO CLINICA (ID_CLINICA, NOME) VALUES (2, 'Clínica B');
INSERT INTO CLINICA (ID_CLINICA, NOME) VALUES (3, 'Clínica C');
INSERT INTO CLINICA (ID_CLINICA, NOME) VALUES (4, 'Clínica D');
INSERT INTO CLINICA (ID_CLINICA, NOME) VALUES (5, 'Clínica E');

INSERT INTO FAIXA_ETARIA (ID_FAIXA_ETARIA, NOME) VALUES (1, '0-9 anos');
INSERT INTO FAIXA_ETARIA (ID_FAIXA_ETARIA, NOME) VALUES (2, '10-19 anos');
INSERT INTO FAIXA_ETARIA (ID_FAIXA_ETARIA, NOME) VALUES (3, '20-29 anos');
INSERT INTO FAIXA_ETARIA (ID_FAIXA_ETARIA, NOME) VALUES (4, '30-39 anos');
INSERT INTO FAIXA_ETARIA (ID_FAIXA_ETARIA, NOME) VALUES (5, '40-49 anos');

INSERT INTO MEDICAMENTO (ID_MEDICAMENTO, NOME, MODO_USO) VALUES (1, 'Aspirina', 'Via oral');
INSERT INTO MEDICAMENTO (ID_MEDICAMENTO, NOME, MODO_USO) VALUES (2, 'Paracetamol', 'Via oral');
INSERT INTO MEDICAMENTO (ID_MEDICAMENTO, NOME, MODO_USO) VALUES (3, 'Ibuprofeno', 'Via oral');
INSERT INTO MEDICAMENTO (ID_MEDICAMENTO, NOME, MODO_USO) VALUES (4, 'Amoxicilina', 'Via oral');
INSERT INTO MEDICAMENTO (ID_MEDICAMENTO, NOME, MODO_USO) VALUES (5, 'Diazepam', 'Via oral');

INSERT INTO LOCAL (ID_LOCAL, NOME) VALUES (1, 'São Paulo');
INSERT INTO LOCAL (ID_LOCAL, NOME) VALUES (2, 'Rio de Janeiro');
INSERT INTO LOCAL (ID_LOCAL, NOME) VALUES (3, 'Belo Horizonte');
INSERT INTO LOCAL (ID_LOCAL, NOME) VALUES (4, 'Brasília');
INSERT INTO LOCAL (ID_LOCAL, NOME) VALUES (5, 'Salvador');

INSERT INTO CONSULTA (ID_TEMPO, ID_ESPECIALIDADE, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, GENERO, FATURAMENTO) VALUES (1, 1, 1, 1, 1, 'M', 250.50);
INSERT INTO CONSULTA (ID_TEMPO, ID_ESPECIALIDADE, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, GENERO, FATURAMENTO) VALUES (1, 1, 1, 2, 2, 'F', 180.80);
INSERT INTO CONSULTA (ID_TEMPO, ID_ESPECIALIDADE, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, GENERO, FATURAMENTO) VALUES (1, 2, 2, 3, 3, 'F', 350.00);
-- INSERT INTO CONSULTA (ID_TEMPO, ID_ESPECIALIDADE, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, GENERO, FATURAMENTO) VALUES (2, 3, 3, 4, 4, 'M', 150.00);
-- INSERT INTO CONSULTA (ID_TEMPO, ID_ESPECIALIDADE, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, GENERO, FATURAMENTO) VALUES (2, 4, 4, 5, 5, 'F', 200.00);

INSERT INTO PRESCRICAO (ID_TEMPO, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, ID_MEDICAMENTO, GENERO, FATURAMENTO) VALUES (1, 1, 1, 1, 1, 'M', 50.00);
INSERT INTO PRESCRICAO (ID_TEMPO, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, ID_MEDICAMENTO, GENERO, FATURAMENTO) VALUES (1, 1, 1, 2, 2, 'F', 80.00);
INSERT INTO PRESCRICAO (ID_TEMPO, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, ID_MEDICAMENTO, GENERO, FATURAMENTO) VALUES (1, 2, 2, 3, 3, 'F', 120.00);
-- INSERT INTO PRESCRICAO (ID_TEMPO, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, ID_MEDICAMENTO, GENERO, FATURAMENTO) VALUES (2, 3, 3, 4, 4, 'M', 60.00);
-- INSERT INTO PRESCRICAO (ID_TEMPO, ID_CLINICA, ID_LOCAL, ID_FAIXA_ETARIA, ID_MEDICAMENTO, GENERO, FATURAMENTO) VALUES (2, 4, 4, 5, 5, 'F', 90.00);


SELECT LOCAL.NOME, ESPECIALIDADE.NOME, CLINICA.NOME, FAIXA_ETARIA.NOME, CONSULTA.GENERO, SUM(CONSULTA.FATURAMENTO) AS "TOTAL FATURADO (R$)"
FROM CONSULTA
JOIN LOCAL ON CONSULTA.ID_LOCAL = LOCAL.ID_LOCAL
JOIN ESPECIALIDADE ON CONSULTA.ID_ESPECIALIDADE = ESPECIALIDADE.ID_ESPECIALIDADE
JOIN CLINICA ON CONSULTA.ID_CLINICA = CLINICA.ID_CLINICA
JOIN FAIXA_ETARIA ON CONSULTA.ID_FAIXA_ETARIA = FAIXA_ETARIA.ID_FAIXA_ETARIA
GROUP BY CUBE (LOCAL.NOME, ESPECIALIDADE.NOME, CLINICA.NOME, FAIXA_ETARIA.NOME, GENERO);



SELECT MEDICAMENTO.NOME, COUNT(PRESCRICAO.FATURAMENTO) AS "TOTAL PRESCIÇÃO"
FROM PRESCRICAO
JOIN MEDICAMENTO ON PRESCRICAO.ID_MEDICAMENTO = MEDICAMENTO.ID_MEDICAMENTO
GROUP BY CUBE (MEDICAMENTO.NOME);